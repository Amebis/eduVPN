<?xml version="1.0" encoding="utf-8"?>
<!--
    eduVPN - VPN for education and research

    Copyright: 2017-2021 The Commons Conservancy eduVPN Programme
    SPDX-License-Identifier: GPL-3.0+
-->

<?define LanguageList=ar;de;fr;nb;nl;pt-PT;sl;tr;uk?>

<?if $(var.ClientTarget) = "eduVPN"?>
    <?define openvpnserv.exe.reg0.ComponentGUID = "{95745DBA-88C1-4FD6-AF79-2D34B2E9D4F4}"?>
    <?define openvpnserv.exe.reg1.ComponentGUID = "{457AD4F6-7330-409B-8AA9-11C5AA17B2AD}"?>
    <?define openvpnserv.exe.reg2.ComponentGUID = "{5A36E0F2-D707-4A43-A039-2D6B4231BF23}"?>
    <?define openvpnserv.exe.reg3.ComponentGUID = "{3D89AA2C-04E3-49C2-A2BC-19B957ED4F74}"?>
    <?define openvpnserv.exe.reg4.ComponentGUID = "{E551E92B-B79A-41E7-909C-656AEDDFAE1C}"?>
    <?define openvpnserv.exe.reg5.ComponentGUID = "{9C350B91-873A-4F0F-BBDD-D422071AE78C}"?>
    <?define openvpnserv.exe.reg6.ComponentGUID = "{D59FD7FA-E687-4A43-B8A2-077ECDD02B6D}"?>
    <?define openvpnserv.exe.reg7.ComponentGUID = "{2140688F-04A2-42C9-B9C8-1314B721C82D}"?>
<?elseif $(var.ClientTarget) = "LetsConnect"?>
    <?define openvpnserv.exe.reg0.ComponentGUID = "{CD0E5551-72D5-487C-ADB6-3FF86EA83CC1}"?>
    <?define openvpnserv.exe.reg1.ComponentGUID = "{7EF617D1-1B9E-4B96-A4C7-9A4597370AA2}"?>
    <?define openvpnserv.exe.reg2.ComponentGUID = "{5E0F8717-1CCF-40B3-A3FE-AFE367973C73}"?>
    <?define openvpnserv.exe.reg3.ComponentGUID = "{CF896642-99B2-4BD1-9FD2-89E73F3C38B2}"?>
    <?define openvpnserv.exe.reg4.ComponentGUID = "{F9F27191-D01C-4DF2-8112-288B9D086628}"?>
    <?define openvpnserv.exe.reg5.ComponentGUID = "{2D450249-CCD0-4C4C-AD9A-793C864FE1B7}"?>
    <?define openvpnserv.exe.reg6.ComponentGUID = "{EB68C746-5E50-4F66-9A21-2E6BB07EEA38}"?>
    <?define openvpnserv.exe.reg7.ComponentGUID = "{A40AFCF3-E0DE-4844-91CE-64D55C3FA8B5}"?>
<?else?>
    <?error Unknown client?>
<?endif?>

<Wix
    xmlns="http://schemas.microsoft.com/wix/2006/wi"
    xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">
    <Product
        Id="*"
        UpgradeCode="$(var.Core.UpgradeGUID)"
        Version="$(var.Core.Version)"
        Language="!(loc.ProductLanguage)"
        Name="!(loc.$(var.ClientTarget).CoreName) $(var.Core.VersionInformational)"
        Manufacturer="!(loc.ManufacturerName)">

        <Package
            InstallScope="perMachine"
            InstallerVersion="400"
            Compressed="yes"
            SummaryCodepage="!(loc.SummaryCodepage)"
            ReadOnly="yes"/>

        <Media
            Id="1"
            Cabinet="Core.cab"
            EmbedCab="yes"/>

        <Icon
            Id="App.ico"
            SourceFile="$(var.ClientTarget).Client\Resources\App.ico"/>

        <Binary
            Id="OpenVPN.MSICA.dll"
            SourceFile="OpenVPN.MSICA.dll"/>

        <Property Id="ARPPRODUCTICON" Value="App.ico"/>
        <Property Id="ARPURLINFOABOUT" Value="$(var.ClientAboutUri)"/>
        <Property Id="WINTUNPOOL" Value="OpenVPN$$$(var.ClientTarget)"/>


        <!--
            Upgrading functionality
        -->
        <MajorUpgrade
            DowngradeErrorMessage="!(loc.NewerVersionInstalled)"
            Schedule="afterInstallExecute"
            AllowSameVersionUpgrades="yes"/>
        <?if $(var.ClientTarget) = "eduVPN"?>
        <Property Id="OLDVERSIONSINSTALLED" Secure="yes"/>
        <Upgrade Id="{ADD9689E-1061-43AF-85C6-2AAB99A7284E}">
            <UpgradeVersion
                Minimum="0.0.0.0"
                Maximum="1.0.10.0"
                Property="OLDVERSIONSINSTALLED"
                IncludeMinimum="yes"
                MigrateFeatures="yes"/>
        </Upgrade>
        <?endif?>
        <Property Id="TAPWININSTALLED" Secure="yes"/>
        <Upgrade Id="$(var.TAPWin.UpgradeGUID)">
            <UpgradeVersion
                Minimum="0.0.0.0"
                Property="TAPWININSTALLED"
                IncludeMinimum="yes"
                MigrateFeatures="no"
                IgnoreRemoveFailure="yes"/>
        </Upgrade>
        <Property Id="OPENVPNINSTALLED" Secure="yes"/>
        <Upgrade Id="$(var.OpenVPN.UpgradeGUID)">
            <UpgradeVersion
                Minimum="0.0.0.0"
                Property="OPENVPNINSTALLED"
                IncludeMinimum="yes"
                MigrateFeatures="no"
                IgnoreRemoveFailure="yes"/>
        </Upgrade>
        <?if $(var.ClientTarget) = "eduVPN"?>
        <Property Id="OLDOPENVPNINSTALLED" Secure="yes"/>
        <Upgrade Id="{CFE55281-AE4B-42A8-A1C3-76E94A733341}">
            <UpgradeVersion
                Minimum="0.0.0.0"
                Maximum="2.4.4.1"
                Property="OLDOPENVPNINSTALLED"
                IncludeMinimum="yes"
                IncludeMaximum="yes"
                MigrateFeatures="no"
                IgnoreRemoveFailure="yes"/>
        </Upgrade>
        <?endif?>
        <Property Id="PRODUCTDIRPREV">
            <ComponentSearch Id="$(var.ClientTarget).Client.exe" Guid="{B7321908-2073-4E7A-8E$(var.ClientId)-5ABA3B46A7DF}"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetBinDirPrev"
            Id="PRODUCTDIR"
            Value="[PRODUCTDIRPREV]"
            Sequence="first"><![CDATA[PRODUCTDIRPREV AND NOT Installed]]></SetProperty>
        <SetProperty
            After="SetBinDirPrev"
            Action="SetBinDirParam"
            Id="PRODUCTDIR"
            Value="[INSTALLDIR]"
            Sequence="first"><![CDATA[INSTALLDIR AND NOT Installed]]></SetProperty>


        <!--
            .NET Framework check
        -->
        <PropertyRef Id="NETFRAMEWORK45"/>
        <Condition Message="!(loc.DotNETFrameworkMissing)"><![CDATA[Installed OR NETFRAMEWORK45]]></Condition>


        <!--
            Folders
        -->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="$(var.ProgramFilesFolder)">
                <Directory Id="PRODUCTDIR" Name="$(var.ClientTitle)" FileSource="$(var.TargetDir)">
                    <Directory Id="OPENVPNCONFIGDIR" Name="config"/>
                    <?foreach Language in $(var.LanguageList)?>
                    <?include Install\$(var.Language)\defs.wxi?>
                    <Directory Id="RESOURCEDIR$(var.LanguageId)" Name="$(var.Language)"/>
                    <?endforeach?>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder"/>
            <Directory Id="DesktopFolder"/>

            <Merge Id="VC150Redist" SourceFile="$(var.VC150RedistMSM)" DiskId="1" Language="0"/>
        </Directory>


        <!--
            Compontents
        -->
        <DirectoryRef Id="PRODUCTDIR">
            <Component Id="libcrypto_1_1.dll" Guid="{AD510CA3-3A66-4244-93$(var.ClientId)-75FEF678EDE4}">
                <File Source="$(var.OpenVPN.Dir)libcrypto-1_1$(var.OpenSSL.Platform).dll"/>
            </Component>
            <Component Id="libssl_1_1.dll" Guid="{DBDCEEED-C4C1-407C-9D$(var.ClientId)-DF47CBABD967}">
                <File Source="$(var.OpenVPN.Dir)libssl-1_1$(var.OpenSSL.Platform).dll"/>
            </Component>
            <Component Id="liblzo2_2.dll" Guid="{3F09667C-7437-469A-BF$(var.ClientId)-DAF0FBB59975}">
                <File Source="$(var.OpenVPN.Dir)liblzo2-2.dll"/>
            </Component>
            <Component Id="libpkcs11_helper_1.dll" Guid="{DF6FA2C5-EA65-488A-B9$(var.ClientId)-4BA3A26CB7A1}">
                <File Source="$(var.OpenVPN.Dir)libpkcs11-helper-1.dll"/>
            </Component>
            <Component Id="wintun.dll" Guid="{BCD1B70D-A1D3-4DC1-98$(var.ClientId)-8E90D8EF9FE0}">
                <File Source="$(var.OpenVPN.Dir)wintun.dll"/>
            </Component>
            <Component Id="openvpn.exe" Guid="{564451A2-D708-4B65-A9$(var.ClientId)-7B0767044A09}">
                <File Source="$(var.OpenVPN.Dir)openvpn.exe"/>
            </Component>
            <Component Id="openvpnserv.exe" Guid="{B67B7CC6-FC70-485A-9D$(var.ClientId)-AC0BC814D02D}">
                <File Source="$(var.OpenVPN.Dir)openvpnserv.exe"/>
                <CreateFolder Directory="OPENVPNCONFIGDIR">
                    <!--
                        SYSTEM (SY): full
                        Administrators (BA): full
                        Users (BU): create files
                        CREATOR OWNER (CO): full
                    -->
                    <PermissionEx Id="OPENVPNCONFIGDIR" Sddl="D:PAI(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;;0x100003;;;BU)(A;OIIO;FA;;;CO)"/>
                </CreateFolder>
                <RemoveFile
                    Id="OPENVPNCONFIGDIR.conf"
                    Directory="OPENVPNCONFIGDIR"
                    Name="*.conf"
                    On="uninstall"/>
                <RemoveFile
                    Id="OPENVPNCONFIGDIR.txt"
                    Directory="OPENVPNCONFIGDIR"
                    Name="*.txt"
                    On="uninstall"/>
                <RemoveFolder
                    Id="OPENVPNCONFIGDIR"
                    Directory="OPENVPNCONFIGDIR"
                    On="uninstall"/>
                <?if $(var.ClientTarget) = "eduVPN"?>
                <!-- Until 1.0-alpha6, Interactive Service was installed as eduVPNServiceInteractive. -->
                <ServiceControl
                    Id="eduVPNServiceInteractive"
                    Name="eduVPNServiceInteractive"
                    Stop="install"
                    Remove="install"/>
                <?endif?>
                <ServiceControl
                    Id="OpenVPNServiceInteractive.$(var.ClientTarget)"
                    Name="OpenVPNServiceInteractive$$$(var.ClientTarget)"
                    Start="install"
                    Stop="both"
                    Remove="uninstall"/>
                <ServiceInstall
                    Id="OpenVPNServiceInteractive.$(var.ClientTarget)"
                    Name="OpenVPNServiceInteractive$$$(var.ClientTarget)"
                    DisplayName="@[PRODUCTDIR]eduVPN.Resources.dll,-$(var.IDS_CLIENT_PREFIX)5"
                    Description="@[PRODUCTDIR]eduVPN.Resources.dll,-$(var.IDS_CLIENT_PREFIX)6"
                    Arguments="-instance interactive $$$(var.ClientTarget)"
                    Type="ownProcess"
                    Start="auto"
                    ErrorControl="normal">
                    <ServiceDependency Id="Dhcp"/>
                </ServiceInstall>
            </Component>
            <Component Id="openvpnserv.exe.reg0" Guid="$(var.openvpnserv.exe.reg0.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Type="string"
                    Value="[PRODUCTDIR]"/>
            </Component>
            <Component Id="openvpnserv.exe.reg1" Guid="$(var.openvpnserv.exe.reg1.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="exe_path"
                    Type="string"
                    Value="[PRODUCTDIR]openvpn.exe"/>
            </Component>
            <Component Id="openvpnserv.exe.reg2" Guid="$(var.openvpnserv.exe.reg2.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="config_dir"
                    Type="string"
                    Value="[OPENVPNCONFIGDIR]"/>
            </Component>
            <Component Id="openvpnserv.exe.reg3" Guid="$(var.openvpnserv.exe.reg3.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="config_ext"
                    Type="string"
                    Value="conf"/>
            </Component>
            <Component Id="openvpnserv.exe.reg4" Guid="$(var.openvpnserv.exe.reg4.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="log_dir"
                    Type="string"
                    Value="[PRODUCTDIR]"/>
            </Component>
            <Component Id="openvpnserv.exe.reg5" Guid="$(var.openvpnserv.exe.reg5.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="log_append"
                    Type="string"
                    Value="0"/>
            </Component>
            <Component Id="openvpnserv.exe.reg6" Guid="$(var.openvpnserv.exe.reg6.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="priority"
                    Type="string"
                    Value="NORMAL_PRIORITY_CLASS"/>
            </Component>
            <Component Id="openvpnserv.exe.reg7" Guid="$(var.openvpnserv.exe.reg7.ComponentGUID)">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\OpenVPN$$$(var.ClientTarget)"
                    Name="ovpn_admin_group"
                    Type="string"
                    Value="Users"/>
            </Component>

            <Component Id="System.ValueTuple.dll" Guid="{C8FC5755-2F1E-4967-BF$(var.ClientId)-ACDA10877D32}">
                <File Source="System.ValueTuple.dll"/>
            </Component>
            <Component Id="Prism.dll" Guid="{F88C1DFD-B204-419F-90$(var.ClientId)-16F29139A014}">
                <File Source="Prism.dll"/>
            </Component>
            <Component Id="eduEd25519.dll" Guid="{E0B6D73B-BA57-4461-BE$(var.ClientId)-591E39FD8700}">
                <File Source="eduEd25519.dll"/>
            </Component>
            <Component Id="eduEx.dll" Guid="{82DB9679-20F0-4AA1-8D$(var.ClientId)-40ACC84DFCAB}">
                <File Source="eduEx.dll"/>
            </Component>
            <Component Id="eduJSON.dll" Guid="{6D3A2015-49C6-4860-BA$(var.ClientId)-51750332A926}">
                <File Source="eduJSON.dll"/>
            </Component>
            <Component Id="eduOAuth.dll" Guid="{B42E5C23-0C98-4EF2-85$(var.ClientId)-263D731E354A}">
                <File Source="eduOAuth.dll"/>
            </Component>
            <Component Id="eduOpenVPN.dll" Guid="{28FC2938-848C-454D-80$(var.ClientId)-F1192984569C}">
                <File Source="eduOpenVPN.dll"/>
            </Component>
            <Component Id="eduVPN.dll" Guid="{2A1383F4-107A-479D-BD$(var.ClientId)-49D1388D04C1}">
                <File Source="eduVPN.dll"/>
            </Component>
            <Component Id="eduVPN.Views.dll" Guid="{2600BA9D-8AA3-46D5-88$(var.ClientId)-2823B998BF96}">
                <File Source="eduVPN.Views.dll"/>
            </Component>
            <Component Id="eduVPN.Resources.dll" Guid="{F6C90B86-77AC-49A6-B3$(var.ClientId)-5BCF15028CFA}">
                <File Source="eduVPN.Resources.dll"/>
            </Component>
            <Component Id="$(var.ClientTarget).Client.exe" Guid="{B7321908-2073-4E7A-8E$(var.ClientId)-5ABA3B46A7DF}">
                <File Source="$(var.ClientTarget).Client.exe" KeyPath="yes"/>

                <!-- Note: "$(var.ClientTarget).Client" feature and "App.ico" icon are defined elsewhere. -->
                <Shortcut
                    Id="$(var.ClientTarget).Client.exe.StartMenuShortcut"
                    Directory="ProgramMenuFolder"
                    Name="$(var.ClientTitle) Client" DisplayResourceDll="[PRODUCTDIR]eduVPN.Resources.dll" DisplayResourceId="$(var.IDS_CLIENT_PREFIX)1"
                    DescriptionResourceDll="[PRODUCTDIR]eduVPN.Resources.dll" DescriptionResourceId="$(var.IDS_CLIENT_PREFIX)2"
                    Target="$(var.ClientTarget).Client"
                    WorkingDirectory="PRODUCTDIR"
                    Icon="App.ico"/>
            </Component>
            <Component Id="$(var.ClientTarget).Client.exe.config" Guid="{BDAFF1F9-BC26-4758-A2$(var.ClientId)-D5253117D595}">
                <File Source="$(var.ClientTarget).Client.exe.config"/>
            </Component>
            <!--
            <Component Id="$(var.ClientTarget).Client.exe.DesktopShortcut" Guid="{C630B2C1-7CD1-4E9C-90$(var.ClientId)-1F6EA79C5D85}">
                <Shortcut
                    Id="$(var.ClientTarget).Client.exe.DesktopShortcut"
                    Directory="DesktopFolder"
                    Name="$(var.ClientTitle) Client" DisplayResourceDll="[PRODUCTDIR]eduVPN.Resources.dll" DisplayResourceId="$(var.IDS_CLIENT_PREFIX)1"
                    DescriptionResourceDll="[PRODUCTDIR]eduVPN.Resources.dll" DescriptionResourceId="$(var.IDS_CLIENT_PREFIX)2"
                    Target="[PRODUCTDIR]$(var.ClientTarget).Client.exe"
                    WorkingDirectory="PRODUCTDIR"
                    Icon="App.ico"/>
                <RemoveFolder Id="$(var.ClientTarget).Client.exe.DesktopShortcut" Directory="DesktopFolder" On="uninstall"/>
                <RegistryValue Root="HKCU" Key="SOFTWARE\$(var.ClientUrn)" Name="DesktopShortcut" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
            -->

            <!-- Add/Remove Programs Localization -->
            <!-- TODO: Shouldn't component GUIDs change with every [ProductCode] change as the component key path changes? -->
            <Component Id="ARP.DisplayName" Guid="{9B193EA7-D92A-4B21-B5$(var.ClientId)-83696C1DA3F0}">
                <RegistryValue Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\[ProductCode]" Name="DisplayName_Localized" Type="string" Value="@[PRODUCTDIR]eduVPN.Resources.dll,-$(var.IDS_CLIENT_PREFIX)1"/>
            </Component>
            <Component Id="ARP.Publisher" Guid="{B1843E16-2328-46C3-82$(var.ClientId)-4D37C14609BB}">
                <RegistryValue Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\[ProductCode]" Name="Publisher_Localized" Type="string" Value="@[PRODUCTDIR]eduVPN.Resources.dll,-$(var.IDS_CLIENT_PREFIX)3"/>
            </Component>
        </DirectoryRef>
        <?foreach Language in $(var.LanguageList)?>
        <?include Install\$(var.Language)\defs.wxi?>
        <DirectoryRef Id="RESOURCEDIR$(var.LanguageId)">
            <Component Id="eduEd25519.resources.dll.$(var.LanguageId)" Guid="{1DAC0D20-DB86-$(var.LanguageLcid)-8D$(var.ClientId)-81E9541E2B86}">
                <File Id="eduEd25519.resources.dll.$(var.LanguageId)" Source="$(var.Language)\eduEd25519.resources.dll"/>
            </Component>
            <Component Id="eduJSON.resources.dll.$(var.LanguageId)" Guid="{245001DE-AD4D-$(var.LanguageLcid)-94$(var.ClientId)-2B8B5CCBB5F6}">
                <File Id="eduJSON.resources.dll.$(var.LanguageId)" Source="$(var.Language)\eduJSON.resources.dll"/>
            </Component>
            <Component Id="eduOAuth.resources.dll.$(var.LanguageId)" Guid="{85E8357D-8A7F-$(var.LanguageLcid)-B2$(var.ClientId)-DDA49F2E2FCB}">
                <File Id="eduOAuth.resources.dll.$(var.LanguageId)" Source="$(var.Language)\eduOAuth.resources.dll"/>
            </Component>
            <Component Id="eduOpenVPN.resources.dll.$(var.LanguageId)" Guid="{3EB12483-9ADF-$(var.LanguageLcid)-84$(var.ClientId)-2C4145655CAA}">
                <File Id="eduOpenVPN.resources.dll.$(var.LanguageId)" Source="$(var.Language)\eduOpenVPN.resources.dll"/>
            </Component>
            <Component Id="eduVPN.resources.dll.$(var.LanguageId)" Guid="{B3E2ED54-F2BB-$(var.LanguageLcid)-B1$(var.ClientId)-F82C85A7E8B2}">
                <File Id="eduVPN.resources.dll.$(var.LanguageId)" Source="$(var.Language)\eduVPN.resources.dll"/>
            </Component>
            <Component Id="eduVPN.Views.resources.dll.$(var.LanguageId)" Guid="{67ABCB8F-0088-$(var.LanguageLcid)-AB$(var.ClientId)-5ADF6774D86D}">
                <File Id="eduVPN.Views.resources.dll.$(var.LanguageId)" Source="$(var.Language)\eduVPN.Views.resources.dll"/>
            </Component>
        </DirectoryRef>
        <?endforeach?>


        <!--
            Features
        -->
        <Feature Id="$(var.ClientTarget).Client" Title="!(loc.$(var.ClientTarget).CoreName)" Level="1">
            <ComponentRef Id="libcrypto_1_1.dll"/>
            <ComponentRef Id="libssl_1_1.dll"/>
            <ComponentRef Id="liblzo2_2.dll"/>
            <ComponentRef Id="libpkcs11_helper_1.dll"/>
            <ComponentRef Id="wintun.dll"/>
            <ComponentRef Id="openvpn.exe"/>
            <ComponentRef Id="openvpnserv.exe"/>
            <ComponentRef Id="openvpnserv.exe.reg0"/>
            <ComponentRef Id="openvpnserv.exe.reg1"/>
            <ComponentRef Id="openvpnserv.exe.reg2"/>
            <ComponentRef Id="openvpnserv.exe.reg3"/>
            <ComponentRef Id="openvpnserv.exe.reg4"/>
            <ComponentRef Id="openvpnserv.exe.reg5"/>
            <ComponentRef Id="openvpnserv.exe.reg6"/>
            <ComponentRef Id="openvpnserv.exe.reg7"/>

            <MergeRef Id="VC150Redist"/>
            <ComponentRef Id="System.ValueTuple.dll"/>
            <ComponentRef Id="Prism.dll"/>
            <ComponentRef Id="eduEd25519.dll"/>
            <ComponentRef Id="eduEx.dll"/>
            <ComponentRef Id="eduJSON.dll"/>
            <ComponentRef Id="eduOAuth.dll"/>
            <ComponentRef Id="eduOpenVPN.dll"/>
            <ComponentRef Id="eduVPN.dll"/>
            <ComponentRef Id="eduVPN.Views.dll"/>
            <ComponentRef Id="eduVPN.Resources.dll"/>
            <ComponentRef Id="$(var.ClientTarget).Client.exe"/>
            <ComponentRef Id="$(var.ClientTarget).Client.exe.config"/>
            <!--<ComponentRef Id="$(var.ClientTarget).Client.exe.DesktopShortcut"/>-->
            <ComponentRef Id="ARP.DisplayName"/>
            <ComponentRef Id="ARP.Publisher"/>

            <?foreach Language in $(var.LanguageList)?>
            <?include Install\$(var.Language)\defs.wxi?>
            <ComponentRef Id="eduEd25519.resources.dll.$(var.LanguageId)"/>
            <ComponentRef Id="eduJSON.resources.dll.$(var.LanguageId)"/>
            <ComponentRef Id="eduOAuth.resources.dll.$(var.LanguageId)"/>
            <ComponentRef Id="eduOpenVPN.resources.dll.$(var.LanguageId)"/>
            <ComponentRef Id="eduVPN.resources.dll.$(var.LanguageId)"/>
            <ComponentRef Id="eduVPN.Views.resources.dll.$(var.LanguageId)"/>
            <?endforeach?>
        </Feature>


        <!--
            Custom Actions
        -->
        <CustomAction
            Id="EvaluateWintunPool"
            BinaryKey="OpenVPN.MSICA.dll"
            DllEntry="EvaluateWintunPool"/>

        <CustomAction
            Id="RemoveWintunPool"
            BinaryKey="OpenVPN.MSICA.dll"
            DllEntry="RemoveWintunPool"
            Execute="deferred"
            Impersonate="no"/>

        <InstallExecuteSequence>
            <Custom
                Action="EvaluateWintunPool"
                After="ProcessComponents"/>

            <Custom
                Action="RemoveWintunPool"
                Before="RemoveFiles"/>
        </InstallExecuteSequence>

        <UI>
            <Error Id="2550">!(OpenVPN.MSICA [2]: [3]: Error [4]: [5])</Error>
        </UI>
    </Product>
</Wix>
